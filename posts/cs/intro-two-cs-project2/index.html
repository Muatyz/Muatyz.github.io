<!DOCTYPE html>
<html lang="zh" dir="auto">

<head><meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="robots" content="index, follow">
<title>课设 | 无处惹尘埃</title>
<meta name="keywords" content="cs, data analysis">
<meta name="description" content="引航中断会导致港口运营效率较低, 因此对统计数据进行分析可以对引航作业点的移动提供风险评估和决策辅助">
<meta name="author" content="Muartz">
<link rel="canonical" href="https://Muatyz.github.io/posts/cs/intro-two-cs-project2/">
<link crossorigin="anonymous" href="/assets/css/stylesheet.css" rel="preload stylesheet" as="style">
<script defer crossorigin="anonymous" src="/assets/js/highlight.js" onload="hljs.initHighlightingOnLoad();"></script>
<link rel="icon" href="https://Muatyz.github.io/img/Head32.png">
<link rel="icon" type="image/png" sizes="16x16" href="https://Muatyz.github.io/img/Head16.png">
<link rel="icon" type="image/png" sizes="32x32" href="https://Muatyz.github.io/img/Head32.png">
<link rel="apple-touch-icon" href="https://Muatyz.github.io/img/Head32.png">
<link rel="mask-icon" href="https://Muatyz.github.io/img/Head32.png">
<meta name="theme-color" content="#2e2e33">
<meta name="msapplication-TileColor" content="#2e2e33">
<noscript>
    <style>
        #theme-toggle,
        .top-link {
            display: none;
        }

    </style>
    <style>
        @media (prefers-color-scheme: dark) {
            :root {
                --theme: rgb(29, 30, 32);
                --entry: rgb(46, 46, 51);
                --primary: rgb(218, 218, 219);
                --secondary: rgb(155, 156, 157);
                --tertiary: rgb(65, 66, 68);
                --content: rgb(196, 196, 197);
                --hljs-bg: rgb(46, 46, 51);
                --code-bg: rgb(55, 56, 62);
                --border: rgb(51, 51, 51);
            }

            .list {
                background: var(--theme);
            }

            .list:not(.dark)::-webkit-scrollbar-track {
                background: 0 0;
            }

            .list:not(.dark)::-webkit-scrollbar-thumb {
                border-color: var(--theme);
            }
        }

    </style>
</noscript>
<script defer src="https://unpkg.com/mermaid@8.8.1/dist/mermaid.min.js"></script>

<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/font-awesome@4.7.0/css/font-awesome.min.css">
<script src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
<script src="https://cdn.jsdelivr.net/npm/jquery@3.6.3/dist/jquery.min.js"></script>



<script>
var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = ""; 
  var s = document.getElementsByTagName("script")[0]; 
  s.parentNode.insertBefore(hm, s);
})();
</script>

<script type="text/javascript"
        async
        src="https://cdn.bootcss.com/mathjax/2.7.3/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
MathJax.Hub.Config({
  tex2jax: {
    inlineMath: [['$','$'], ['\\(','\\)']],
    displayMath: [['$$','$$'], ['\[\[','\]\]']],
    processEscapes: true,
    processEnvironments: true,
    skipTags: ['script', 'noscript', 'style', 'textarea', 'pre'],
    TeX: { equationNumbers: { autoNumber: "AMS" },
         extensions: ["AMSmath.js", "AMSsymbols.js"] }
  }
});

MathJax.Hub.Queue(function() {
    
    
    
    var all = MathJax.Hub.getAllJax(), i;
    for(i = 0; i < all.length; i += 1) {
        all[i].SourceElement().parentNode.className += ' has-jax';
    }
});
</script>

<style>
code.has-jax {
    font: inherit;
    font-size: 100%;
    background: inherit;
    border: inherit;
    color: #515151;
}
</style>
<meta property="og:title" content="课设" />
<meta property="og:description" content="引航中断会导致港口运营效率较低, 因此对统计数据进行分析可以对引航作业点的移动提供风险评估和决策辅助" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://Muatyz.github.io/posts/cs/intro-two-cs-project2/" />
<meta property="og:image" content="https://s2.loli.net/2023/05/20/ops4b9WAYctdHSE.png" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2023-05-05T12:20:21+08:00" />
<meta property="article:modified_time" content="2023-05-05T12:20:21+08:00" />

<meta name="twitter:card" content="summary_large_image" />
<meta name="twitter:image" content="https://s2.loli.net/2023/05/20/ops4b9WAYctdHSE.png" />
<meta name="twitter:title" content="课设"/>
<meta name="twitter:description" content="引航中断会导致港口运营效率较低, 因此对统计数据进行分析可以对引航作业点的移动提供风险评估和决策辅助"/>


<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BreadcrumbList",
  "itemListElement": [

        {
          "@type": "ListItem",
          "position":  1 ,
          "name": "📚文章",
          "item": "https://Muatyz.github.io/posts/"
        },

        {
          "@type": "ListItem",
          "position":  2 ,
          "name": "👨🏻‍💻 CS",
          "item": "https://Muatyz.github.io/posts/cs/"
        }, 
    {
      "@type": "ListItem",
      "position":  3 ,
      "name": "课设",
      "item": "https://Muatyz.github.io/posts/cs/intro-two-cs-project2/"
    }
  ]
}
</script>
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "课设",
  "name": "课设",
  "description": "引航中断会导致港口运营效率较低, 因此对统计数据进行分析可以对引航作业点的移动提供风险评估和决策辅助",
  "keywords": [
    "cs", "data analysis"
  ],
  "articleBody": " 涉密警告 本次课设所使用的十年引航中断相关的数据均为涉密, 而本小组全体成员均已签订保密契约以进行课设工作. 因此下面所使用的代码不会展示任何具体的数据, 而只是展示其工作原理. 本文将介绍本人所负责的问题一部分, 即对十年的引航中断数据进行分析, 并且得出相应的结论.\n问题分析 项目提供的数据集给出了 2011-2020 共 10 年发生引航中断的情况统计, 其中导致引航中断的原因包括大风管制和能见度不良两类, 本题中暂不考虑能见度不良情况的分析, 只关注大风管制的分析. 请筛选出大风管制的情况统计, 统计大风管制日的风向、风级情况 注意: 风向和风级情况每日可能不是稳定的, 请设计数据处理规则, 能够有效地代表当日的风向、风级情况.\n要求运用数据可视化的方法展示统计结果, 并文字说明风向和风级的数据处理规则, 附 XLSX 文件, 包括全部大风管制日的风向和风级. (15 分)\n根据上一问中的分析, 建模分析不同风向和风级对触发引航中断的影响, 要求展现出 10 年间的影响情况, 并给出触发引航中断的风向和风级规律(可以是各因素的独立阈值, 也可以是双因素耦合的阈值). (15 分) 数据样例介绍： Sheet 1：2020年通航管制情况统计表——2020年引航中断时间的汇总, 其中本题只考虑大风管制的情况, 分别包括引航暂停的日期、暂停起止时间和暂停时长. Sheet 2：2020年1月8日洋山港海事局工作报告——使用其中的舟山附近沿海当日气象简报. Sheet 3：观测线6警戒区——经过观测线的船舶信息记录, 使用其中的船名、船舶种类、船舶长度、报告线名称、船舶航向、船舶航速、穿越时间、经度和纬度等信息. 观察发现所给的数据表格格式不一, 为了能够使用统一方式对数据进行挖掘处理, 需要将所有文件整合为 XLSX 格式.\n按年顺序读取源表格文件后, 读取首页的 sheet 并且读取对应的日期. 在这个过程中, 还涉及了对于 sheet 格式上的剪裁处理和对字符串的重整化.\n由任务要求可知, 需要整理大风管制引起的引航中断, 因此可以提取大风管制对应的日期并查询当天海面的天气情况.\n而在该任务提供的数据文件中, 天气信息都是纯粹文本, 我们需要对其中的有效信息进行提取. 所以在这里我们选择了使用正则表达式进行筛选.\n读取到各年大风管制日期下的风向风级后, 就可以使用 OriginPro 软件提供的绘图功能对(风向, 风级)信息进行统计并且总结规律.\n任务一所涉及的代码根据需求被分为两个部分:classifier.py, calcute.py. 前者进行数据的读取, 后者进行数据的整理.\n读取数据 #classifier.py #! -*- coding=utf-8 -*- from numpy import NaN import pandas as pd import re import openpyxl import pyexcel as p import xlwings as xw import shutil years=[str(x) for x in range(2011,2020+1)] for year in years: #按年读取表格文件############################################### parentpath=r\"./Project02-Data-31/任务一-引航中断-气象统计数据\" path=parentpath+r'/'+year+r\"年气象统计.xlsx\" #将新的mainsheet写入原来的表格而不删除其余的sheet if int(year)\u003e=2019: #2019年和2020年文件为.xls格式, 转为.xlsx格式 p.save_book_as(file_name=path[:-1],dest_file_name=path) f=pd.ExcelFile(path) wb=xw.Book(path) SheetNames=f.sheet_names mainsheet=pd.read_excel(path,sheet_name=SheetNames[0]) #将sheet整理为和2019年以前相同的格式（即删除表头并日期列调整至第一列） mainsheet=mainsheet.iloc[1:,1:] orisht=wb.sheets(SheetNames[0]) orisht.delete() sht=wb.sheets.add(name=year+'年影响通航',before=SheetNames[1]) sht.range('A1').value=mainsheet.values wb.save(year+r\"年气象统计.xlsx\") wb.close() file=year+r\"年气象统计.xlsx\" shutil.copy(file,parentpath)#将生成的文件覆盖在源文件上 ######################################################### f=pd.ExcelFile(path) #获取工作表名称 SheetNames=f.sheet_names #检查是否读取成功 print(SheetNames) #读取第一张sheet mainsheet=pd.read_excel(path,sheet_name=year+'年影响通航') #读取第一页的文件并获得一些基本数据 rowNum=mainsheet.shape[0] #读取第一页sheet的第一二列的有效数据 datePlus=mainsheet.iloc[2:rowNum-3,[0,1]] datePlus=datePlus.dropna(axis=0,how='any') #获取当年大风管制日期 date=datePlus.iloc[:,0] #检查读取的大风管制时间段 print(date) #将时间段拆分为单天 Date=[] for i in range(date.shape[0]): date.iloc[i]=date.iloc[i][5:] series=[] if '-' in date.iloc[i]: ###########对.和-进行定位############### loc1=date.iloc[i].index('.') loc2=date.iloc[i].index('-') ######注意去除日期单元格中偶尔出现的中文## begin=int(re.sub('[\\u4e00-\\u9fa5]', '',date.iloc[i][loc1+1:loc2])) end=int(re.sub('[\\u4e00-\\u9fa5]', '',date.iloc[i][loc2+1:])) month=str(re.sub('[\\u4e00-\\u9fa5]', '',date.iloc[i][:loc1+1])) for j in range(begin,end+1): if month+str(j) not in Date: #############避免重复登记已经登记过的日期####### Date.append(month+str(j)) else: Date.append(str(re.sub('[\\u4e00-\\u9fa5]', '',date.iloc[i]))) date=pd.DataFrame(date) #检查去年份是否成功 print(date) #检查真正的日期序列是否生成成功 print(Date) ########以生成的日期依次查询当年的风向风级的情况########### Time=[] Land=[] #海面的天气信息相较于陆地的对引航中断应当更直接 Sea=[] for day in Date: \"\"\" 该版本为完全排除空日期(无法由Date直接查询到的日期) \"\"\" if day in SheetNames: Sheet=pd.read_excel(path,sheet_name=day) Time.append(day) Land.append(Sheet.iloc[1,0]) Sea.append(Sheet.iloc[2,0]) else: #最严谨的方式是如果这一天没有读取到, 应当再读取前一天天气中\"明天\"的信息 #但是天气的记录格式不一, 所以这里选择若没有该天的天气记录, 就选择不录入 pass #创建时间和天气关系的字典并生成表格 dic={'Day':Time,'Land':Land,'Sea':Sea} Ori=pd.DataFrame(dic) #检查生成风向风级原始数据表是否成功 print(Ori) #######文本处理程序, 读取原始数据中的风向和风级信息############### #创建空表格以备读写 tmp=pd.DataFrame() processedPath='./ProcessedData/ProcessedData'+year+'.xlsx' tmpFile=tmp.to_excel(processedPath) #使用正则表达式进行信息读取 for orisentence in Sea: WeatherDay=str(Time[Sea.index(orisentence)]) law=r\"([今|明|后]天)?([东|西|偏]?[南|北|东|西]?)?[到]?([东|西|偏]?[南|北|东|西|阵]?)?风(\\d)[\\-]?([\\d]?)级\" Weather=re.findall(law,orisentence,re.S) ''' 此处使用的正则表达式进行天气信息的筛选, 严格来说应该编辑状态自动机进行读取. 但是由于天气信息的撰写方式实在不一, 所以选用了一个通用性较高的方法. 若用Pytorch进行语言处理应当是最专业的, 限于能力水平并未使用. ''' if Weather: day=[] #风向可能会发生改变, 如\"东到东北风\"等 diraction1=[] diraction2=[] #记录最小风级和最大风级 minscale=[] maxscale=[] for i in range(len(Weather)): day.append(Weather[i][0]) #若有空白部分, 则从另一部分复制数据# ############风向部分的空白填充############# if Weather[i][2]=='': diraction1.append(Weather[i][1]) diraction2.append(Weather[i][1]) elif Weather[i][2]=='': diraction1.append(Weather[i][2]) diraction2.append(Weather[i][2]) else: diraction1.append(Weather[i][1]) diraction2.append(Weather[i][2]) ##############风级部分的空白填充########## if Weather[i][4]!='' and int(Weather[i][3])\u003eint(Weather[i][4]): #排除读到10的时候将1和0拆开 minscale.append(str(Weather[i][3])+str(Weather[i][4])) maxscale.append(str(Weather[i][3])+str(Weather[i][4])) elif Weather[i][4]=='': #对仅有一个数字的进行复制粘贴处理 minscale.append(str(Weather[i][3])) maxscale.append(str(Weather[i][3])) else: #其他情况正常入位 minscale.append(str(Weather[i][3])) maxscale.append(str(Weather[i][4])) #生成日期和天气关系的字典并生成表格 weatherdic={'日期':day,'风向1':diraction1,'风向2':diraction2,'小风级':minscale,'大风级':maxscale} df=pd.DataFrame(weatherdic) #在该文件中依次创建新worksheet,填入相应的df with pd.ExcelWriter(processedPath,mode='a') as writer: df.to_excel(writer,sheet_name=WeatherDay) #清理读写期间产生的无用sheet(即Sheet1) processedExcel=openpyxl.load_workbook(processedPath) wastedSheet=processedExcel['Sheet1'] processedExcel.remove(wastedSheet) #将读写完毕的表格存储起来 processedExcel.save(processedPath) 分析数据 风向分级确定准则 由上述的代码不难看出, 对于一段源文件的天气信息文本, 即使是同一正则表达式也可能会读出多条结果. 有的是同一天内的多条数据, 有的是不同天里的数据(这是因为某些日期的数据并不存在于对应的大风管制日期的表格中, 而是存在于某些相邻的大风管制日期.)\n所以我们收集天气的策略是: 已知大风管制期间的天气记录并不止一天, 结合正则表达式的读取效果, 将读取数据的第一天和第二天之间的所有数据； 然后风级就是风向数据的最大值和最小值, 风向则是这些数据的第一对(记录数据时, 风向可能会以\"东到东北风\"的方式呈现, 所以风向会以成对的形式记录下来. 至于本来就只有一个风向的, 就视为这一对风向的两个元素都是相同的).\n虽然这样的处理可能看似有些草率, 但是结合具体的天气信息文本不难看出, 出现异常情况往往都是都会是日期连报(如’今天、明天东到东北风’), 而且大风管制的日期也有可能是连续的, 所以即使按照上文所述的模糊识别方法, 也是有一定证据支撑的.\n下面是具体的代码实现:\n#! -*- coding=utf-8 -*- from numpy import NAN, NaN, nan import pandas as pd #######################读取真正的风向风级################## #逐年读取已经生成完毕的日期-天气表格 years=[str(x) for x in range(2011,2020+1)] #预先分配list以存储读取的对应数据 Time=[] Diraction1=[] Diraction2=[] minScale=[] maxScale=[] for year in years: processedPath='./ProcessedData/ProcessedData'+year+'.xlsx' f=pd.ExcelFile(processedPath) SheetNames=f.sheet_names #按天读取当天的风向风级 for day in SheetNames: sht=pd.read_excel(processedPath,sheet_name=day) date=list(sht['日期'].values) dira1=list(sht['风向1'].values) dira2=list(sht['风向2'].values) scale1=list(sht['小风级'].values) scale2=list(sht['大风级'].values) #去除空白日期，即记录在'日期'列里实际记录的天数(今天，明天或后天) date_brief=[sing for sing in date if sing==sing] #记录日期所在位置的索引 date_index=[] for sing in date_brief: date_index.append(date.index(sing)) if len(date_brief)==1: #若记录在列的只有一天，那么无论这一天是哪一天都将其作为当天的数据 diraction1=dira1[date_index[0]:] diraction2=dira2[date_index[0]:] minscale=min(scale1[date_index[0]:]) maxscale=max(scale2[date_index[0]:]) else: #记录的不止一天的时候，就将第一天和第二天之间的数据收集起来 #即，有可能读取到的是\"今天，后天\",那么也会记录这两者之间的所有数据 diraction1=dira1[date_index[0]:date_index[1]] diraction2=dira2[date_index[0]:date_index[1]] minscale=min(scale1[date_index[0]:date_index[1]]) maxscale=max(scale2[date_index[0]:date_index[1]]) #预先分配list对风向的两个方向进行存储 d1list=[] d2list=[] #记录风向风级时先记录对应天的日期，为了避免重复还要加上年份的信息 Time.append(year+r'.'+day) #在数据中会有空格和'阵'的数据，按照我们对于地理的理解即阵风为最大风级 #所以在记录时，将两天之间的所有风级进行比较，阵风为最大值所以必定包括在比较当中 for d1 in diraction1: if str(d1)!='nan' and str(d1)!='阵': d1list.append(str(d1)) for d2 in diraction2: if str(d2)!='nan' and str(d2)!='阵': d2list.append(str(d2)) #完成对于数据的清理之后，读取风向的规则即为其中的第一次风向信息的结果 #即，忽略了随着时间变化风向信息随之变化的过程。 #最严谨的方法是结合天气记录档案的最下方的引航中断时间(中午或者下午)来判断 #最正确的时间，但是仅仅借助正则表达式这个任务是异常困难的 Diraction1.append(d1list[0].replace('偏','')) Diraction2.append(d2list[0].replace('偏','')) #在使用正则表达式读取风向的时候，会读进'偏'字符 #在进行数据处理时则将偏字去除以备后期进行字典代换 minScale.append(minscale) maxScale.append(maxscale) #手动写入方向和度数的对应字典 word_to_num={'东':0,'西':180,'南':270,'北':90,'东南':315,'东北':45,'西南':225,'西北':135} #预先分配读入读数的list Diraction1_num=[] Diraction2_num=[] #使用已写好的字典对方向进行代换 for i in range(len(Time)): Diraction1_num.append(word_to_num[Diraction1[i]]) Diraction2_num.append(word_to_num[Diraction2[i]]) #生成新字典并且生成表格 dira_and_scale={'日期':Time,'风向1':Diraction1,'风向1num':Diraction1_num,'风向2':Diraction2,'风向2num':Diraction2_num,'小风级':minScale,'大风级':maxScale} df=pd.DataFrame(dira_and_scale) processedPath='./ProcessedData/data.xlsx' #将生成的表格记录下 file=df.to_excel(processedPath) 结论 首先是得到一张十年尺度的日期-风向风级的表格, 其中已经包含了对风向读为度数的列.\n使用 OriginPro 的风向玫瑰图的绘制功能不难绘制出风向和风级在大风管制期间的规律. 由上述图可以分析得到的结论是:\n大风管制发生时，风向各个风向都有，但是大多集中在西北方向，而且也是西北方向的风级最大; 风级一般要达到5级及以上时才会触发满足大风管制的条件. ",
  "wordCount" : "4766",
  "inLanguage": "zh",
  "image":"https://s2.loli.net/2023/05/20/ops4b9WAYctdHSE.png","datePublished": "2023-05-05T12:20:21+08:00",
  "dateModified": "2023-05-05T12:20:21+08:00",
  "author":[{
    "@type": "Person",
    "name": "Muartz"
  }],
  "mainEntityOfPage": {
    "@type": "WebPage",
    "@id": "https://Muatyz.github.io/posts/cs/intro-two-cs-project2/"
  },
  "publisher": {
    "@type": "Organization",
    "name": "无处惹尘埃",
    "logo": {
      "@type": "ImageObject",
      "url": "https://Muatyz.github.io/img/Head32.png"
    }
  }
}
</script>
</head>

<body class="" id="top">
<script>
    (function () {
        let  arr,reg = new RegExp("(^| )"+"change-themes"+"=([^;]*)(;|$)");
        if(arr = document.cookie.match(reg)) {
        } else {
            if (new Date().getHours() >= 19 || new Date().getHours() < 6) {
                document.body.classList.add('dark');
                localStorage.setItem("pref-theme", 'dark');
            } else {
                document.body.classList.remove('dark');
                localStorage.setItem("pref-theme", 'light');
            }
        }
    })()

    if (localStorage.getItem("pref-theme") === "dark") {
        document.body.classList.add('dark');
    } else if (localStorage.getItem("pref-theme") === "light") {
        document.body.classList.remove('dark')
    } else if (window.matchMedia('(prefers-color-scheme: dark)').matches) {
        document.body.classList.add('dark');
    }
</script>

<header class="header">
    <nav class="nav">
        <div class="logo">
            <a href="https://Muatyz.github.io/" accesskey="h" title="计算物理学习日志 (Alt + H)">
            <img src="https://Muatyz.github.io/img/Head64.png" alt="logo" aria-label="logo"
                 height="35">计算物理学习日志</a>
            <div class="logo-switches">
                <button id="theme-toggle" accesskey="t" title="(Alt + T)">
                    <svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"
                         fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                         stroke-linejoin="round">
                        <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
                    </svg>
                    <svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"
                         fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                         stroke-linejoin="round">
                        <circle cx="12" cy="12" r="5"></circle>
                        <line x1="12" y1="1" x2="12" y2="3"></line>
                        <line x1="12" y1="21" x2="12" y2="23"></line>
                        <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
                        <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
                        <line x1="1" y1="12" x2="3" y2="12"></line>
                        <line x1="21" y1="12" x2="23" y2="12"></line>
                        <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
                        <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
                    </svg>
                </button>
            </div>
        </div>
        <ul id="menu">
            <li>
                <a href="https://Muatyz.github.io/search" title="🔍 搜索 (Alt &#43; /)" accesskey=/>
                <span>🔍 搜索</span>
                </a>
            </li>
            <li>
                <a href="https://Muatyz.github.io/" title="🏠 主页">
                <span>🏠 主页</span>
                </a>
            </li>
            <li>
                <a href="https://Muatyz.github.io/posts" title="📚 文章">
                <span>📚 文章</span>
                </a>
            </li>
            <li>
                <a href="https://Muatyz.github.io/tags" title="🧩 标签">
                <span>🧩 标签</span>
                </a>
            </li>
            <li>
                <a href="https://Muatyz.github.io/archives/" title="⏱️ 时间轴">
                <span>⏱️ 时间轴</span>
                </a>
            </li>
            <li>
                <a href="https://Muatyz.github.io/about" title="🙋🏻‍♂️ 关于">
                <span>🙋🏻‍♂️ 关于</span>
                </a>
            </li>
            <li>
                <a href="https://Muatyz.github.io/links" title="🤝 友链">
                <span>🤝 友链</span>
                </a>
            </li>
        </ul>
    </nav>
</header>
<main class="main page">
<style>
    i[id*="post_meta_style"] {
        display: flex;
        align-items: center;
        margin: 0 0 10px 0;
    }
</style>

<article class="post-single">
    <div id="single-content">
        <header class="post-header">
            <div class="breadcrumbs"><a href="https://Muatyz.github.io/">🏠 主页</a>&nbsp;»&nbsp;<a href="https://Muatyz.github.io/posts/">📚文章</a>&nbsp;»&nbsp;<a href="https://Muatyz.github.io/posts/cs/">👨🏻‍💻 CS</a></div>
            <h1 class="post-title">
                课设
            </h1>
            <div class="post-description">
                引航中断会导致港口运营效率较低, 因此对统计数据进行分析可以对引航作业点的移动提供风险评估和决策辅助
            </div>
            <div class="post-meta">

<style>
    i[id*="post_meta_style"] {
        display: flex;
        align-items: center;
        margin: 0 0 10px 0;
    }

    .parent-post-meta {
        display: flex;
        flex-wrap: wrap;
        opacity: 0.8;
    }
</style>

<span class="parent-post-meta">
    <span id="post_meta_style_1">
        <span class="fa fa-calendar-check-o"></span>
        <span>2023-05-05
            &nbsp;&nbsp;
        </span>
    </span>
    
    
    
    
    
    
    
    <span id="post_meta_style_3">
        <span class="fa fa-file-word-o"></span>
        <span>4766字
            &nbsp;&nbsp;
        </span>
    </span>
    <span id="post_meta_style_4">
        <span class="fa fa-clock-o"></span>
        <span>10分钟
            &nbsp;&nbsp;
        </span>
    </span>
    <span id="post_meta_style_5">
        <span class="fa fa-user-o"></span>
        <span>Muartz
            &nbsp;&nbsp;
        </span>
    </span>
    <span id="post_meta_style_6">
        <span class="fa fa-tags" style="opacity: 0.8"></span>
        <span>
            <span class="post-tags-meta">
                <a href="https://Muatyz.github.io/tags/data-analysis/" style="color: var(--secondary)!important;">data analysis</a>
                &nbsp;<a href="https://Muatyz.github.io/tags/cs/" style="color: var(--secondary)!important;">cs</a>
            </span>
        </span>
    </span>
</span>
<span style="opacity: 0.8;">
                    <span id="post_meta_style_7">
                        &nbsp;&nbsp;
                        <span class="fa fa-eye" ></span>
                        <span>
                            <span id="busuanzi_container_page_pv"><span id="busuanzi_value_page_pv"></span></span>
                            &nbsp;&nbsp;
                        </span>
                    </span>
                    <span id="post_meta_style_8">
                        <span class="fa fa-commenting-o"></span>
                        <span>
                            <script src="https://cdn.staticfile.org/twikoo/1.6.16/twikoo.all.min.js"></script>
                            <script>
                                let url = document.documentURI
                                
                                let dnsUrl = "https://Muatyz.github.io/"
                                let urlSplit = url.split(dnsUrl)
                                let finalUrl = urlSplit[1]
                                if (finalUrl[0] !== '/') {
                                    finalUrl = '/'+finalUrl
                                }
                                twikoo.getCommentsCount({
                                    envId: "https://www.muartz.com", 
                                region: "ap-shanghai", 
                                urls: [ 
                                    
                                    finalUrl,
                                ],
                                    includeReply: false 
                                }).then(function (res) {
                                    let count = res[0].count
                                    const obj = document.getElementById("comment_count");
                                    obj.innerText = count
                                    
                                    
                                    
                                }).catch(function (err) {
                                    
                                    console.error(err);
                                });
                            </script>
                            <span id="comment_count"></span>
                        </span>
                    </span>
                </span>

</div>
        </header> 
<figure class="entry-cover1"><img style="zoom:50%;" loading="lazy" src="https://s2.loli.net/2023/05/20/ops4b9WAYctdHSE.png" alt="">
    
</figure><aside id="toc-container" class="toc-container wide">
    <div class="toc">
        <details  open>
        <summary accesskey="c" title="(Alt + C)">
            <span class="details">目录</span>
        </summary>

        <div class="inner"><ul>
                <li>
                    <a href="#%e9%97%ae%e9%a2%98%e5%88%86%e6%9e%90" aria-label="问题分析">问题分析</a></li>
                <li>
                    <a href="#%e8%af%bb%e5%8f%96%e6%95%b0%e6%8d%ae" aria-label="读取数据">读取数据</a></li>
                <li>
                    <a href="#%e5%88%86%e6%9e%90%e6%95%b0%e6%8d%ae" aria-label="分析数据">分析数据</a><ul>
                        
                <li>
                    <a href="#%e9%a3%8e%e5%90%91%e5%88%86%e7%ba%a7%e7%a1%ae%e5%ae%9a%e5%87%86%e5%88%99" aria-label="风向分级确定准则">风向分级确定准则</a></li></ul>
                </li>
                <li>
                    <a href="#%e7%bb%93%e8%ae%ba" aria-label="结论">结论</a>
                </li>
            </ul>
        </div>
        </details>
    </div>
</aside>
<script>
    let activeElement;
    let elements;
    window.addEventListener('DOMContentLoaded', function (event) {
        checkTocPosition();

        elements = document.querySelectorAll('h1[id],h2[id],h3[id],h4[id],h5[id],h6[id]');
        
        activeElement = elements[0];
        const id = encodeURI(activeElement.getAttribute('id')).toLowerCase();
        document.querySelector(`.inner ul li a[href="#${id}"]`).classList.add('active');
    }, false);

    window.addEventListener('resize', function(event) {
        checkTocPosition();
    }, false);

    window.addEventListener('scroll', () => {
        
        activeElement = Array.from(elements).find((element) => {
            if ((getOffsetTop(element) - window.pageYOffset) > 0 &&
                (getOffsetTop(element) - window.pageYOffset) < window.innerHeight/2) {
                return element;
            }
        }) || activeElement

        elements.forEach(element => {
            const id = encodeURI(element.getAttribute('id')).toLowerCase();
            if (element === activeElement){
                document.querySelector(`.inner ul li a[href="#${id}"]`).classList.add('active');
            } else {
                document.querySelector(`.inner ul li a[href="#${id}"]`).classList.remove('active');
            }
        })
    }, false);

    const main = parseInt(getComputedStyle(document.body).getPropertyValue('--article-width'), 10);
    const toc = parseInt(getComputedStyle(document.body).getPropertyValue('--toc-width'), 10);
    const gap = parseInt(getComputedStyle(document.body).getPropertyValue('--gap'), 10);

    function checkTocPosition() {
        const width = document.body.scrollWidth;
        if (width - main - (toc * 2) - (gap * 4) > 0) {
            document.getElementById("toc-container").classList.add("wide");
        } else {
            document.getElementById("toc-container").classList.remove("wide");
        }
    }

    function getOffsetTop(element) {
        if (!element.getClientRects().length) {
            return 0;
        }
        let rect = element.getBoundingClientRect();
        let win = element.ownerDocument.defaultView;
        return rect.top + win.pageYOffset;
    }
</script>
        <div class="post-content"><div class="details admonition warning open">

 <div class="details-summary admonition-title">

 <i class="icon fas fa-exclamation-triangle fa-fw"></i>涉密警告<i class="details-icon fas fa-angle-right fa-fw"></i>

 </div>

 <div class="details-content">

 <div class="admonition-content">本次课设所使用的十年引航中断相关的数据均为涉密, 而本小组全体成员均已签订保密契约以进行课设工作. 因此下面所使用的代码不会展示任何具体的数据, 而只是展示其工作原理.</div>

 </div>

 </div>
<p>本文将介绍本人所负责的<strong>问题一</strong>部分, 即对十年的引航中断数据进行分析, 并且得出相应的结论.</p>
<h1 id="问题分析">问题分析<a hidden class="anchor" aria-hidden="true" href="#问题分析">#</a></h1>
<blockquote>
<ul>
<li>项目提供的数据集给出了 2011-2020 共 10 年发生引航中断的情况统计, 其中导致引航中断的原因包括大风管制和能见度不良两类, 本题中暂不考虑能见度不良情况的分析, 只关注大风管制的分析. 请筛选出大风管制的情况统计, 统计大风管制日的风向、风级情况</li>
</ul>
<blockquote>
<p>注意: 风向和风级情况每日可能不是稳定的, 请设计数据处理规则, 能够有效地代表当日的风向、风级情况.</p>
</blockquote>
<p>要求运用数据可视化的方法展示统计结果, 并文字说明风向和风级的数据处理规则, 附 XLSX 文件, 包括全部大风管制日的风向和风级. (15 分)</p>
<ul>
<li>根据上一问中的分析, 建模分析不同风向和风级对触发引航中断的影响, 要求展现出 10 年间的影响情况, 并给出触发引航中断的风向和风级规律(可以是各因素的独立阈值, 也可以是双因素耦合的阈值). (15 分)</li>
<li>数据样例介绍：
<ul>
<li>Sheet 1：2020年通航管制情况统计表——2020年引航中断时间的汇总, 其中本题只考虑大风管制的情况, 分别包括引航暂停的日期、暂停起止时间和暂停时长.</li>
<li>Sheet 2：2020年1月8日洋山港海事局工作报告——使用其中的舟山附近沿海当日气象简报.</li>
<li>Sheet 3：观测线6警戒区——经过观测线的船舶信息记录, 使用其中的船名、船舶种类、船舶长度、报告线名称、船舶航向、船舶航速、穿越时间、经度和纬度等信息.</li>
</ul>
</li>
</ul>
</blockquote>
<p>观察发现所给的数据表格格式不一, 为了能够使用统一方式对数据进行挖掘处理, 需要将所有文件整合为 XLSX 格式.</p>
<p>按年顺序读取源表格文件后, 读取首页的 sheet 并且读取对应的日期. 在这个过程中, 还涉及了对于 sheet 格式上的剪裁处理和对字符串的重整化.</p>
<p>由任务要求可知, 需要整理大风管制引起的引航中断, 因此可以提取大风管制对应的日期并查询当天海面的天气情况.</p>
<p>而在该任务提供的数据文件中, 天气信息都是纯粹文本, 我们需要对其中的有效信息进行提取. 所以在这里我们选择了使用正则表达式进行筛选.</p>
<p>读取到各年大风管制日期下的风向风级后, 就可以使用 OriginPro 软件提供的绘图功能对(风向, 风级)信息进行统计并且总结规律.</p>
<p>任务一所涉及的代码根据需求被分为两个部分:classifier.py, calcute.py. 前者进行数据的读取, 后者进行数据的整理.</p>
<h1 id="读取数据">读取数据<a hidden class="anchor" aria-hidden="true" href="#读取数据">#</a></h1>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#75715e">#classifier.py</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#! -*- coding=utf-8 -*-</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">from</span> numpy <span style="color:#f92672">import</span> NaN
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> pandas <span style="color:#66d9ef">as</span> pd
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> re
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> openpyxl
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> pyexcel <span style="color:#66d9ef">as</span> p
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> xlwings <span style="color:#66d9ef">as</span> xw
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> shutil
</span></span><span style="display:flex;"><span>		
</span></span><span style="display:flex;"><span>years<span style="color:#f92672">=</span>[str(x) <span style="color:#66d9ef">for</span> x <span style="color:#f92672">in</span> range(<span style="color:#ae81ff">2011</span>,<span style="color:#ae81ff">2020</span><span style="color:#f92672">+</span><span style="color:#ae81ff">1</span>)]
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">for</span> year <span style="color:#f92672">in</span> years:
</span></span><span style="display:flex;"><span><span style="color:#75715e">#按年读取表格文件###############################################</span>
</span></span><span style="display:flex;"><span>	parentpath<span style="color:#f92672">=</span><span style="color:#e6db74">r</span><span style="color:#e6db74">&#34;./Project02-Data-31/任务一-引航中断-气象统计数据&#34;</span>
</span></span><span style="display:flex;"><span>	path<span style="color:#f92672">=</span>parentpath<span style="color:#f92672">+</span><span style="color:#e6db74">r</span><span style="color:#e6db74">&#39;/&#39;</span><span style="color:#f92672">+</span>year<span style="color:#f92672">+</span><span style="color:#e6db74">r</span><span style="color:#e6db74">&#34;年气象统计.xlsx&#34;</span>
</span></span><span style="display:flex;"><span>	<span style="color:#75715e">#将新的mainsheet写入原来的表格而不删除其余的sheet</span>
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">if</span> int(year)<span style="color:#f92672">&gt;=</span><span style="color:#ae81ff">2019</span>:
</span></span><span style="display:flex;"><span>		<span style="color:#75715e">#2019年和2020年文件为.xls格式, 转为.xlsx格式</span>
</span></span><span style="display:flex;"><span>		p<span style="color:#f92672">.</span>save_book_as(file_name<span style="color:#f92672">=</span>path[:<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>],dest_file_name<span style="color:#f92672">=</span>path)
</span></span><span style="display:flex;"><span>		f<span style="color:#f92672">=</span>pd<span style="color:#f92672">.</span>ExcelFile(path)
</span></span><span style="display:flex;"><span>		wb<span style="color:#f92672">=</span>xw<span style="color:#f92672">.</span>Book(path)
</span></span><span style="display:flex;"><span>		SheetNames<span style="color:#f92672">=</span>f<span style="color:#f92672">.</span>sheet_names
</span></span><span style="display:flex;"><span>		mainsheet<span style="color:#f92672">=</span>pd<span style="color:#f92672">.</span>read_excel(path,sheet_name<span style="color:#f92672">=</span>SheetNames[<span style="color:#ae81ff">0</span>])
</span></span><span style="display:flex;"><span>		<span style="color:#75715e">#将sheet整理为和2019年以前相同的格式（即删除表头并日期列调整至第一列）</span>
</span></span><span style="display:flex;"><span>		mainsheet<span style="color:#f92672">=</span>mainsheet<span style="color:#f92672">.</span>iloc[<span style="color:#ae81ff">1</span>:,<span style="color:#ae81ff">1</span>:]
</span></span><span style="display:flex;"><span>		orisht<span style="color:#f92672">=</span>wb<span style="color:#f92672">.</span>sheets(SheetNames[<span style="color:#ae81ff">0</span>])
</span></span><span style="display:flex;"><span>		orisht<span style="color:#f92672">.</span>delete()
</span></span><span style="display:flex;"><span>		sht<span style="color:#f92672">=</span>wb<span style="color:#f92672">.</span>sheets<span style="color:#f92672">.</span>add(name<span style="color:#f92672">=</span>year<span style="color:#f92672">+</span><span style="color:#e6db74">&#39;年影响通航&#39;</span>,before<span style="color:#f92672">=</span>SheetNames[<span style="color:#ae81ff">1</span>])
</span></span><span style="display:flex;"><span>		sht<span style="color:#f92672">.</span>range(<span style="color:#e6db74">&#39;A1&#39;</span>)<span style="color:#f92672">.</span>value<span style="color:#f92672">=</span>mainsheet<span style="color:#f92672">.</span>values
</span></span><span style="display:flex;"><span>		wb<span style="color:#f92672">.</span>save(year<span style="color:#f92672">+</span><span style="color:#e6db74">r</span><span style="color:#e6db74">&#34;年气象统计.xlsx&#34;</span>)
</span></span><span style="display:flex;"><span>		wb<span style="color:#f92672">.</span>close()
</span></span><span style="display:flex;"><span>		file<span style="color:#f92672">=</span>year<span style="color:#f92672">+</span><span style="color:#e6db74">r</span><span style="color:#e6db74">&#34;年气象统计.xlsx&#34;</span>
</span></span><span style="display:flex;"><span>		shutil<span style="color:#f92672">.</span>copy(file,parentpath)<span style="color:#75715e">#将生成的文件覆盖在源文件上</span>
</span></span><span style="display:flex;"><span>			
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">#########################################################</span>
</span></span><span style="display:flex;"><span>	f<span style="color:#f92672">=</span>pd<span style="color:#f92672">.</span>ExcelFile(path)
</span></span><span style="display:flex;"><span>	<span style="color:#75715e">#获取工作表名称</span>
</span></span><span style="display:flex;"><span>	SheetNames<span style="color:#f92672">=</span>f<span style="color:#f92672">.</span>sheet_names
</span></span><span style="display:flex;"><span>	<span style="color:#75715e">#检查是否读取成功</span>
</span></span><span style="display:flex;"><span>	print(SheetNames)
</span></span><span style="display:flex;"><span>	<span style="color:#75715e">#读取第一张sheet</span>
</span></span><span style="display:flex;"><span>	mainsheet<span style="color:#f92672">=</span>pd<span style="color:#f92672">.</span>read_excel(path,sheet_name<span style="color:#f92672">=</span>year<span style="color:#f92672">+</span><span style="color:#e6db74">&#39;年影响通航&#39;</span>)
</span></span><span style="display:flex;"><span>	<span style="color:#75715e">#读取第一页的文件并获得一些基本数据</span>
</span></span><span style="display:flex;"><span>	rowNum<span style="color:#f92672">=</span>mainsheet<span style="color:#f92672">.</span>shape[<span style="color:#ae81ff">0</span>]
</span></span><span style="display:flex;"><span>	<span style="color:#75715e">#读取第一页sheet的第一二列的有效数据</span>
</span></span><span style="display:flex;"><span>	datePlus<span style="color:#f92672">=</span>mainsheet<span style="color:#f92672">.</span>iloc[<span style="color:#ae81ff">2</span>:rowNum<span style="color:#f92672">-</span><span style="color:#ae81ff">3</span>,[<span style="color:#ae81ff">0</span>,<span style="color:#ae81ff">1</span>]]
</span></span><span style="display:flex;"><span>	datePlus<span style="color:#f92672">=</span>datePlus<span style="color:#f92672">.</span>dropna(axis<span style="color:#f92672">=</span><span style="color:#ae81ff">0</span>,how<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;any&#39;</span>)
</span></span><span style="display:flex;"><span>	<span style="color:#75715e">#获取当年大风管制日期</span>
</span></span><span style="display:flex;"><span>	date<span style="color:#f92672">=</span>datePlus<span style="color:#f92672">.</span>iloc[:,<span style="color:#ae81ff">0</span>]
</span></span><span style="display:flex;"><span>	<span style="color:#75715e">#检查读取的大风管制时间段</span>
</span></span><span style="display:flex;"><span>	print(date)
</span></span><span style="display:flex;"><span>	<span style="color:#75715e">#将时间段拆分为单天</span>
</span></span><span style="display:flex;"><span>	Date<span style="color:#f92672">=</span>[]
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">for</span> i <span style="color:#f92672">in</span> range(date<span style="color:#f92672">.</span>shape[<span style="color:#ae81ff">0</span>]):
</span></span><span style="display:flex;"><span>		date<span style="color:#f92672">.</span>iloc[i]<span style="color:#f92672">=</span>date<span style="color:#f92672">.</span>iloc[i][<span style="color:#ae81ff">5</span>:]
</span></span><span style="display:flex;"><span>		series<span style="color:#f92672">=</span>[]
</span></span><span style="display:flex;"><span>		<span style="color:#66d9ef">if</span> <span style="color:#e6db74">&#39;-&#39;</span> <span style="color:#f92672">in</span> date<span style="color:#f92672">.</span>iloc[i]:
</span></span><span style="display:flex;"><span>			<span style="color:#75715e">###########对.和-进行定位###############</span>
</span></span><span style="display:flex;"><span>			loc1<span style="color:#f92672">=</span>date<span style="color:#f92672">.</span>iloc[i]<span style="color:#f92672">.</span>index(<span style="color:#e6db74">&#39;.&#39;</span>)
</span></span><span style="display:flex;"><span>			loc2<span style="color:#f92672">=</span>date<span style="color:#f92672">.</span>iloc[i]<span style="color:#f92672">.</span>index(<span style="color:#e6db74">&#39;-&#39;</span>)
</span></span><span style="display:flex;"><span>			<span style="color:#75715e">######注意去除日期单元格中偶尔出现的中文##</span>
</span></span><span style="display:flex;"><span>			begin<span style="color:#f92672">=</span>int(re<span style="color:#f92672">.</span>sub(<span style="color:#e6db74">&#39;[</span><span style="color:#ae81ff">\u4e00</span><span style="color:#e6db74">-</span><span style="color:#ae81ff">\u9fa5</span><span style="color:#e6db74">]&#39;</span>, <span style="color:#e6db74">&#39;&#39;</span>,date<span style="color:#f92672">.</span>iloc[i][loc1<span style="color:#f92672">+</span><span style="color:#ae81ff">1</span>:loc2]))
</span></span><span style="display:flex;"><span>			end<span style="color:#f92672">=</span>int(re<span style="color:#f92672">.</span>sub(<span style="color:#e6db74">&#39;[</span><span style="color:#ae81ff">\u4e00</span><span style="color:#e6db74">-</span><span style="color:#ae81ff">\u9fa5</span><span style="color:#e6db74">]&#39;</span>, <span style="color:#e6db74">&#39;&#39;</span>,date<span style="color:#f92672">.</span>iloc[i][loc2<span style="color:#f92672">+</span><span style="color:#ae81ff">1</span>:]))
</span></span><span style="display:flex;"><span>			month<span style="color:#f92672">=</span>str(re<span style="color:#f92672">.</span>sub(<span style="color:#e6db74">&#39;[</span><span style="color:#ae81ff">\u4e00</span><span style="color:#e6db74">-</span><span style="color:#ae81ff">\u9fa5</span><span style="color:#e6db74">]&#39;</span>, <span style="color:#e6db74">&#39;&#39;</span>,date<span style="color:#f92672">.</span>iloc[i][:loc1<span style="color:#f92672">+</span><span style="color:#ae81ff">1</span>]))
</span></span><span style="display:flex;"><span>			<span style="color:#66d9ef">for</span> j <span style="color:#f92672">in</span> range(begin,end<span style="color:#f92672">+</span><span style="color:#ae81ff">1</span>):
</span></span><span style="display:flex;"><span>				<span style="color:#66d9ef">if</span> month<span style="color:#f92672">+</span>str(j) <span style="color:#f92672">not</span> <span style="color:#f92672">in</span> Date:
</span></span><span style="display:flex;"><span>					<span style="color:#75715e">#############避免重复登记已经登记过的日期#######</span>
</span></span><span style="display:flex;"><span>					Date<span style="color:#f92672">.</span>append(month<span style="color:#f92672">+</span>str(j))
</span></span><span style="display:flex;"><span>		<span style="color:#66d9ef">else</span>:
</span></span><span style="display:flex;"><span>			Date<span style="color:#f92672">.</span>append(str(re<span style="color:#f92672">.</span>sub(<span style="color:#e6db74">&#39;[</span><span style="color:#ae81ff">\u4e00</span><span style="color:#e6db74">-</span><span style="color:#ae81ff">\u9fa5</span><span style="color:#e6db74">]&#39;</span>, <span style="color:#e6db74">&#39;&#39;</span>,date<span style="color:#f92672">.</span>iloc[i])))
</span></span><span style="display:flex;"><span>	date<span style="color:#f92672">=</span>pd<span style="color:#f92672">.</span>DataFrame(date)
</span></span><span style="display:flex;"><span>	<span style="color:#75715e">#检查去年份是否成功</span>
</span></span><span style="display:flex;"><span>	print(date)
</span></span><span style="display:flex;"><span>	<span style="color:#75715e">#检查真正的日期序列是否生成成功</span>
</span></span><span style="display:flex;"><span>	print(Date)
</span></span><span style="display:flex;"><span>	<span style="color:#75715e">########以生成的日期依次查询当年的风向风级的情况###########</span>
</span></span><span style="display:flex;"><span>	Time<span style="color:#f92672">=</span>[]
</span></span><span style="display:flex;"><span>	Land<span style="color:#f92672">=</span>[]
</span></span><span style="display:flex;"><span>	<span style="color:#75715e">#海面的天气信息相较于陆地的对引航中断应当更直接</span>
</span></span><span style="display:flex;"><span>	Sea<span style="color:#f92672">=</span>[]
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">for</span> day <span style="color:#f92672">in</span> Date:
</span></span><span style="display:flex;"><span>		<span style="color:#e6db74">&#34;&#34;&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">		该版本为完全排除空日期(无法由Date直接查询到的日期)
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">		&#34;&#34;&#34;</span>
</span></span><span style="display:flex;"><span>		<span style="color:#66d9ef">if</span> day <span style="color:#f92672">in</span> SheetNames:
</span></span><span style="display:flex;"><span>			Sheet<span style="color:#f92672">=</span>pd<span style="color:#f92672">.</span>read_excel(path,sheet_name<span style="color:#f92672">=</span>day)
</span></span><span style="display:flex;"><span>			Time<span style="color:#f92672">.</span>append(day)
</span></span><span style="display:flex;"><span>			Land<span style="color:#f92672">.</span>append(Sheet<span style="color:#f92672">.</span>iloc[<span style="color:#ae81ff">1</span>,<span style="color:#ae81ff">0</span>])
</span></span><span style="display:flex;"><span>			Sea<span style="color:#f92672">.</span>append(Sheet<span style="color:#f92672">.</span>iloc[<span style="color:#ae81ff">2</span>,<span style="color:#ae81ff">0</span>])
</span></span><span style="display:flex;"><span>		<span style="color:#66d9ef">else</span>:
</span></span><span style="display:flex;"><span><span style="color:#75715e">#最严谨的方式是如果这一天没有读取到, 应当再读取前一天天气中&#34;明天&#34;的信息</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#但是天气的记录格式不一, 所以这里选择若没有该天的天气记录, 就选择不录入</span>
</span></span><span style="display:flex;"><span>			<span style="color:#66d9ef">pass</span>
</span></span><span style="display:flex;"><span>	<span style="color:#75715e">#创建时间和天气关系的字典并生成表格</span>
</span></span><span style="display:flex;"><span>	dic<span style="color:#f92672">=</span>{<span style="color:#e6db74">&#39;Day&#39;</span>:Time,<span style="color:#e6db74">&#39;Land&#39;</span>:Land,<span style="color:#e6db74">&#39;Sea&#39;</span>:Sea}
</span></span><span style="display:flex;"><span>	Ori<span style="color:#f92672">=</span>pd<span style="color:#f92672">.</span>DataFrame(dic)
</span></span><span style="display:flex;"><span>	<span style="color:#75715e">#检查生成风向风级原始数据表是否成功</span>
</span></span><span style="display:flex;"><span>	print(Ori)
</span></span><span style="display:flex;"><span>	<span style="color:#75715e">#######文本处理程序, 读取原始数据中的风向和风级信息###############</span>
</span></span><span style="display:flex;"><span>	<span style="color:#75715e">#创建空表格以备读写</span>
</span></span><span style="display:flex;"><span>	tmp<span style="color:#f92672">=</span>pd<span style="color:#f92672">.</span>DataFrame()
</span></span><span style="display:flex;"><span>	processedPath<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;./ProcessedData/ProcessedData&#39;</span><span style="color:#f92672">+</span>year<span style="color:#f92672">+</span><span style="color:#e6db74">&#39;.xlsx&#39;</span>
</span></span><span style="display:flex;"><span>	tmpFile<span style="color:#f92672">=</span>tmp<span style="color:#f92672">.</span>to_excel(processedPath)
</span></span><span style="display:flex;"><span>	<span style="color:#75715e">#使用正则表达式进行信息读取</span>
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">for</span> orisentence <span style="color:#f92672">in</span> Sea:
</span></span><span style="display:flex;"><span>		WeatherDay<span style="color:#f92672">=</span>str(Time[Sea<span style="color:#f92672">.</span>index(orisentence)])
</span></span><span style="display:flex;"><span>		law<span style="color:#f92672">=</span><span style="color:#e6db74">r</span><span style="color:#e6db74">&#34;([今|明|后]天)?([东|西|偏]?[南|北|东|西]?)?[到]?([东|西|偏]?[南|北|东|西|阵]?)?风(\d)[\-]?([\d]?)级&#34;</span>
</span></span><span style="display:flex;"><span>		Weather<span style="color:#f92672">=</span>re<span style="color:#f92672">.</span>findall(law,orisentence,re<span style="color:#f92672">.</span>S)
</span></span><span style="display:flex;"><span>		<span style="color:#e6db74">&#39;&#39;&#39;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">此处使用的正则表达式进行天气信息的筛选, 严格来说应该编辑状态自动机进行读取. 
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">但是由于天气信息的撰写方式实在不一, 所以选用了一个通用性较高的方法. 
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">若用Pytorch进行语言处理应当是最专业的, 限于能力水平并未使用. 
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">		&#39;&#39;&#39;</span>
</span></span><span style="display:flex;"><span>		<span style="color:#66d9ef">if</span> Weather:
</span></span><span style="display:flex;"><span>			day<span style="color:#f92672">=</span>[]
</span></span><span style="display:flex;"><span>			<span style="color:#75715e">#风向可能会发生改变, 如&#34;东到东北风&#34;等</span>
</span></span><span style="display:flex;"><span>			diraction1<span style="color:#f92672">=</span>[]
</span></span><span style="display:flex;"><span>			diraction2<span style="color:#f92672">=</span>[]
</span></span><span style="display:flex;"><span>			<span style="color:#75715e">#记录最小风级和最大风级</span>
</span></span><span style="display:flex;"><span>			minscale<span style="color:#f92672">=</span>[]
</span></span><span style="display:flex;"><span>			maxscale<span style="color:#f92672">=</span>[]
</span></span><span style="display:flex;"><span>			<span style="color:#66d9ef">for</span> i <span style="color:#f92672">in</span> range(len(Weather)):
</span></span><span style="display:flex;"><span>				day<span style="color:#f92672">.</span>append(Weather[i][<span style="color:#ae81ff">0</span>])
</span></span><span style="display:flex;"><span>				<span style="color:#75715e">#若有空白部分, 则从另一部分复制数据#</span>
</span></span><span style="display:flex;"><span>				<span style="color:#75715e">############风向部分的空白填充#############</span>
</span></span><span style="display:flex;"><span>				<span style="color:#66d9ef">if</span> Weather[i][<span style="color:#ae81ff">2</span>]<span style="color:#f92672">==</span><span style="color:#e6db74">&#39;&#39;</span>:
</span></span><span style="display:flex;"><span>					diraction1<span style="color:#f92672">.</span>append(Weather[i][<span style="color:#ae81ff">1</span>])
</span></span><span style="display:flex;"><span>					diraction2<span style="color:#f92672">.</span>append(Weather[i][<span style="color:#ae81ff">1</span>])
</span></span><span style="display:flex;"><span>				<span style="color:#66d9ef">elif</span> Weather[i][<span style="color:#ae81ff">2</span>]<span style="color:#f92672">==</span><span style="color:#e6db74">&#39;&#39;</span>:
</span></span><span style="display:flex;"><span>					diraction1<span style="color:#f92672">.</span>append(Weather[i][<span style="color:#ae81ff">2</span>])
</span></span><span style="display:flex;"><span>					diraction2<span style="color:#f92672">.</span>append(Weather[i][<span style="color:#ae81ff">2</span>])
</span></span><span style="display:flex;"><span>				<span style="color:#66d9ef">else</span>:
</span></span><span style="display:flex;"><span>					diraction1<span style="color:#f92672">.</span>append(Weather[i][<span style="color:#ae81ff">1</span>])
</span></span><span style="display:flex;"><span>					diraction2<span style="color:#f92672">.</span>append(Weather[i][<span style="color:#ae81ff">2</span>])
</span></span><span style="display:flex;"><span>				<span style="color:#75715e">##############风级部分的空白填充##########</span>
</span></span><span style="display:flex;"><span>				<span style="color:#66d9ef">if</span> Weather[i][<span style="color:#ae81ff">4</span>]<span style="color:#f92672">!=</span><span style="color:#e6db74">&#39;&#39;</span> <span style="color:#f92672">and</span> int(Weather[i][<span style="color:#ae81ff">3</span>])<span style="color:#f92672">&gt;</span>int(Weather[i][<span style="color:#ae81ff">4</span>]):
</span></span><span style="display:flex;"><span>					<span style="color:#75715e">#排除读到10的时候将1和0拆开</span>
</span></span><span style="display:flex;"><span>					minscale<span style="color:#f92672">.</span>append(str(Weather[i][<span style="color:#ae81ff">3</span>])<span style="color:#f92672">+</span>str(Weather[i][<span style="color:#ae81ff">4</span>]))
</span></span><span style="display:flex;"><span>					maxscale<span style="color:#f92672">.</span>append(str(Weather[i][<span style="color:#ae81ff">3</span>])<span style="color:#f92672">+</span>str(Weather[i][<span style="color:#ae81ff">4</span>]))
</span></span><span style="display:flex;"><span>				<span style="color:#66d9ef">elif</span> Weather[i][<span style="color:#ae81ff">4</span>]<span style="color:#f92672">==</span><span style="color:#e6db74">&#39;&#39;</span>:
</span></span><span style="display:flex;"><span>							<span style="color:#75715e">#对仅有一个数字的进行复制粘贴处理</span>
</span></span><span style="display:flex;"><span>					minscale<span style="color:#f92672">.</span>append(str(Weather[i][<span style="color:#ae81ff">3</span>]))
</span></span><span style="display:flex;"><span>					maxscale<span style="color:#f92672">.</span>append(str(Weather[i][<span style="color:#ae81ff">3</span>]))
</span></span><span style="display:flex;"><span>				<span style="color:#66d9ef">else</span>:
</span></span><span style="display:flex;"><span>					<span style="color:#75715e">#其他情况正常入位</span>
</span></span><span style="display:flex;"><span>					minscale<span style="color:#f92672">.</span>append(str(Weather[i][<span style="color:#ae81ff">3</span>]))
</span></span><span style="display:flex;"><span>					maxscale<span style="color:#f92672">.</span>append(str(Weather[i][<span style="color:#ae81ff">4</span>]))
</span></span><span style="display:flex;"><span>		<span style="color:#75715e">#生成日期和天气关系的字典并生成表格</span>
</span></span><span style="display:flex;"><span>		weatherdic<span style="color:#f92672">=</span>{<span style="color:#e6db74">&#39;日期&#39;</span>:day,<span style="color:#e6db74">&#39;风向1&#39;</span>:diraction1,<span style="color:#e6db74">&#39;风向2&#39;</span>:diraction2,<span style="color:#e6db74">&#39;小风级&#39;</span>:minscale,<span style="color:#e6db74">&#39;大风级&#39;</span>:maxscale}
</span></span><span style="display:flex;"><span>		df<span style="color:#f92672">=</span>pd<span style="color:#f92672">.</span>DataFrame(weatherdic)
</span></span><span style="display:flex;"><span>		<span style="color:#75715e">#在该文件中依次创建新worksheet,填入相应的df</span>
</span></span><span style="display:flex;"><span>		<span style="color:#66d9ef">with</span> pd<span style="color:#f92672">.</span>ExcelWriter(processedPath,mode<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;a&#39;</span>) <span style="color:#66d9ef">as</span> writer:
</span></span><span style="display:flex;"><span>			df<span style="color:#f92672">.</span>to_excel(writer,sheet_name<span style="color:#f92672">=</span>WeatherDay)
</span></span><span style="display:flex;"><span>	<span style="color:#75715e">#清理读写期间产生的无用sheet(即Sheet1)</span>
</span></span><span style="display:flex;"><span>	processedExcel<span style="color:#f92672">=</span>openpyxl<span style="color:#f92672">.</span>load_workbook(processedPath)
</span></span><span style="display:flex;"><span>	wastedSheet<span style="color:#f92672">=</span>processedExcel[<span style="color:#e6db74">&#39;Sheet1&#39;</span>]
</span></span><span style="display:flex;"><span>	processedExcel<span style="color:#f92672">.</span>remove(wastedSheet)
</span></span><span style="display:flex;"><span>	<span style="color:#75715e">#将读写完毕的表格存储起来</span>
</span></span><span style="display:flex;"><span>	processedExcel<span style="color:#f92672">.</span>save(processedPath)
</span></span></code></pre></div><h1 id="分析数据">分析数据<a hidden class="anchor" aria-hidden="true" href="#分析数据">#</a></h1>
<h2 id="风向分级确定准则">风向分级确定准则<a hidden class="anchor" aria-hidden="true" href="#风向分级确定准则">#</a></h2>
<p>由上述的代码不难看出, 对于一段源文件的天气信息文本, 即使是同一正则表达式也可能会读出多条结果. 有的是同一天内的多条数据, 有的是不同天里的数据(这是因为某些日期的数据并不存在于对应的大风管制日期的表格中, 而是存在于某些相邻的大风管制日期.)</p>
<p>所以我们收集天气的策略是: 已知大风管制期间的天气记录并不止一天, 结合正则表达式的读取效果, 将读取数据的第一天和第二天之间的所有数据；
然后风级就是风向数据的最大值和最小值, 风向则是这些数据的第一对(记录数据时, 风向可能会以&quot;东到东北风&quot;的方式呈现, 所以风向会以成对的形式记录下来. 至于本来就只有一个风向的, 就视为这一对风向的两个元素都是相同的).</p>
<p>虽然这样的处理可能看似有些草率, 但是结合具体的天气信息文本不难看出, 出现异常情况往往都是都会是日期连报(如&rsquo;今天、明天东到东北风&rsquo;), 而且大风管制的日期也有可能是连续的, 所以即使按照上文所述的模糊识别方法, 也是有一定证据支撑的.</p>
<p>下面是具体的代码实现:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#75715e">#! -*- coding=utf-8 -*-</span>
</span></span><span style="display:flex;"><span>	<span style="color:#f92672">from</span> numpy <span style="color:#f92672">import</span> NAN, NaN, nan
</span></span><span style="display:flex;"><span>	<span style="color:#f92672">import</span> pandas <span style="color:#66d9ef">as</span> pd
</span></span><span style="display:flex;"><span>		
</span></span><span style="display:flex;"><span>	<span style="color:#75715e">#######################读取真正的风向风级##################</span>
</span></span><span style="display:flex;"><span>	<span style="color:#75715e">#逐年读取已经生成完毕的日期-天气表格</span>
</span></span><span style="display:flex;"><span>	years<span style="color:#f92672">=</span>[str(x) <span style="color:#66d9ef">for</span> x <span style="color:#f92672">in</span> range(<span style="color:#ae81ff">2011</span>,<span style="color:#ae81ff">2020</span><span style="color:#f92672">+</span><span style="color:#ae81ff">1</span>)]
</span></span><span style="display:flex;"><span>	<span style="color:#75715e">#预先分配list以存储读取的对应数据</span>
</span></span><span style="display:flex;"><span>	Time<span style="color:#f92672">=</span>[]
</span></span><span style="display:flex;"><span>	Diraction1<span style="color:#f92672">=</span>[]
</span></span><span style="display:flex;"><span>	Diraction2<span style="color:#f92672">=</span>[]
</span></span><span style="display:flex;"><span>	minScale<span style="color:#f92672">=</span>[]
</span></span><span style="display:flex;"><span>	maxScale<span style="color:#f92672">=</span>[]
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">for</span> year <span style="color:#f92672">in</span> years:
</span></span><span style="display:flex;"><span>		processedPath<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;./ProcessedData/ProcessedData&#39;</span><span style="color:#f92672">+</span>year<span style="color:#f92672">+</span><span style="color:#e6db74">&#39;.xlsx&#39;</span>
</span></span><span style="display:flex;"><span>		f<span style="color:#f92672">=</span>pd<span style="color:#f92672">.</span>ExcelFile(processedPath)
</span></span><span style="display:flex;"><span>		SheetNames<span style="color:#f92672">=</span>f<span style="color:#f92672">.</span>sheet_names
</span></span><span style="display:flex;"><span>		<span style="color:#75715e">#按天读取当天的风向风级</span>
</span></span><span style="display:flex;"><span>		<span style="color:#66d9ef">for</span> day <span style="color:#f92672">in</span> SheetNames:
</span></span><span style="display:flex;"><span>			sht<span style="color:#f92672">=</span>pd<span style="color:#f92672">.</span>read_excel(processedPath,sheet_name<span style="color:#f92672">=</span>day)
</span></span><span style="display:flex;"><span>			date<span style="color:#f92672">=</span>list(sht[<span style="color:#e6db74">&#39;日期&#39;</span>]<span style="color:#f92672">.</span>values)
</span></span><span style="display:flex;"><span>			dira1<span style="color:#f92672">=</span>list(sht[<span style="color:#e6db74">&#39;风向1&#39;</span>]<span style="color:#f92672">.</span>values)
</span></span><span style="display:flex;"><span>			dira2<span style="color:#f92672">=</span>list(sht[<span style="color:#e6db74">&#39;风向2&#39;</span>]<span style="color:#f92672">.</span>values)
</span></span><span style="display:flex;"><span>			scale1<span style="color:#f92672">=</span>list(sht[<span style="color:#e6db74">&#39;小风级&#39;</span>]<span style="color:#f92672">.</span>values)
</span></span><span style="display:flex;"><span>			scale2<span style="color:#f92672">=</span>list(sht[<span style="color:#e6db74">&#39;大风级&#39;</span>]<span style="color:#f92672">.</span>values)
</span></span><span style="display:flex;"><span>			<span style="color:#75715e">#去除空白日期，即记录在&#39;日期&#39;列里实际记录的天数(今天，明天或后天)</span>
</span></span><span style="display:flex;"><span>			date_brief<span style="color:#f92672">=</span>[sing <span style="color:#66d9ef">for</span> sing <span style="color:#f92672">in</span> date <span style="color:#66d9ef">if</span> sing<span style="color:#f92672">==</span>sing]
</span></span><span style="display:flex;"><span>			<span style="color:#75715e">#记录日期所在位置的索引</span>
</span></span><span style="display:flex;"><span>			date_index<span style="color:#f92672">=</span>[]
</span></span><span style="display:flex;"><span>			<span style="color:#66d9ef">for</span> sing <span style="color:#f92672">in</span> date_brief:
</span></span><span style="display:flex;"><span>				date_index<span style="color:#f92672">.</span>append(date<span style="color:#f92672">.</span>index(sing))
</span></span><span style="display:flex;"><span>			<span style="color:#66d9ef">if</span> len(date_brief)<span style="color:#f92672">==</span><span style="color:#ae81ff">1</span>:
</span></span><span style="display:flex;"><span>				<span style="color:#75715e">#若记录在列的只有一天，那么无论这一天是哪一天都将其作为当天的数据</span>
</span></span><span style="display:flex;"><span>				diraction1<span style="color:#f92672">=</span>dira1[date_index[<span style="color:#ae81ff">0</span>]:]
</span></span><span style="display:flex;"><span>				diraction2<span style="color:#f92672">=</span>dira2[date_index[<span style="color:#ae81ff">0</span>]:]
</span></span><span style="display:flex;"><span>				minscale<span style="color:#f92672">=</span>min(scale1[date_index[<span style="color:#ae81ff">0</span>]:])
</span></span><span style="display:flex;"><span>				maxscale<span style="color:#f92672">=</span>max(scale2[date_index[<span style="color:#ae81ff">0</span>]:])
</span></span><span style="display:flex;"><span>			<span style="color:#66d9ef">else</span>:
</span></span><span style="display:flex;"><span>			<span style="color:#75715e">#记录的不止一天的时候，就将第一天和第二天之间的数据收集起来</span>
</span></span><span style="display:flex;"><span>			<span style="color:#75715e">#即，有可能读取到的是&#34;今天，后天&#34;,那么也会记录这两者之间的所有数据</span>
</span></span><span style="display:flex;"><span>				diraction1<span style="color:#f92672">=</span>dira1[date_index[<span style="color:#ae81ff">0</span>]:date_index[<span style="color:#ae81ff">1</span>]]
</span></span><span style="display:flex;"><span>				diraction2<span style="color:#f92672">=</span>dira2[date_index[<span style="color:#ae81ff">0</span>]:date_index[<span style="color:#ae81ff">1</span>]]
</span></span><span style="display:flex;"><span>				minscale<span style="color:#f92672">=</span>min(scale1[date_index[<span style="color:#ae81ff">0</span>]:date_index[<span style="color:#ae81ff">1</span>]])
</span></span><span style="display:flex;"><span>				maxscale<span style="color:#f92672">=</span>max(scale2[date_index[<span style="color:#ae81ff">0</span>]:date_index[<span style="color:#ae81ff">1</span>]])
</span></span><span style="display:flex;"><span>			<span style="color:#75715e">#预先分配list对风向的两个方向进行存储</span>
</span></span><span style="display:flex;"><span>			d1list<span style="color:#f92672">=</span>[]
</span></span><span style="display:flex;"><span>			d2list<span style="color:#f92672">=</span>[]
</span></span><span style="display:flex;"><span>			<span style="color:#75715e">#记录风向风级时先记录对应天的日期，为了避免重复还要加上年份的信息</span>
</span></span><span style="display:flex;"><span>			Time<span style="color:#f92672">.</span>append(year<span style="color:#f92672">+</span><span style="color:#e6db74">r</span><span style="color:#e6db74">&#39;.&#39;</span><span style="color:#f92672">+</span>day)
</span></span><span style="display:flex;"><span>			<span style="color:#75715e">#在数据中会有空格和&#39;阵&#39;的数据，按照我们对于地理的理解即阵风为最大风级</span>
</span></span><span style="display:flex;"><span>			<span style="color:#75715e">#所以在记录时，将两天之间的所有风级进行比较，阵风为最大值所以必定包括在比较当中</span>
</span></span><span style="display:flex;"><span>			<span style="color:#66d9ef">for</span> d1 <span style="color:#f92672">in</span> diraction1:
</span></span><span style="display:flex;"><span>				<span style="color:#66d9ef">if</span> str(d1)<span style="color:#f92672">!=</span><span style="color:#e6db74">&#39;nan&#39;</span> <span style="color:#f92672">and</span> str(d1)<span style="color:#f92672">!=</span><span style="color:#e6db74">&#39;阵&#39;</span>:
</span></span><span style="display:flex;"><span>					d1list<span style="color:#f92672">.</span>append(str(d1))
</span></span><span style="display:flex;"><span>			<span style="color:#66d9ef">for</span> d2 <span style="color:#f92672">in</span> diraction2:
</span></span><span style="display:flex;"><span>				<span style="color:#66d9ef">if</span> str(d2)<span style="color:#f92672">!=</span><span style="color:#e6db74">&#39;nan&#39;</span> <span style="color:#f92672">and</span> str(d2)<span style="color:#f92672">!=</span><span style="color:#e6db74">&#39;阵&#39;</span>:
</span></span><span style="display:flex;"><span>					d2list<span style="color:#f92672">.</span>append(str(d2))
</span></span><span style="display:flex;"><span>			<span style="color:#75715e">#完成对于数据的清理之后，读取风向的规则即为其中的第一次风向信息的结果</span>
</span></span><span style="display:flex;"><span>			<span style="color:#75715e">#即，忽略了随着时间变化风向信息随之变化的过程。</span>
</span></span><span style="display:flex;"><span>			<span style="color:#75715e">#最严谨的方法是结合天气记录档案的最下方的引航中断时间(中午或者下午)来判断</span>
</span></span><span style="display:flex;"><span>			<span style="color:#75715e">#最正确的时间，但是仅仅借助正则表达式这个任务是异常困难的</span>
</span></span><span style="display:flex;"><span>			Diraction1<span style="color:#f92672">.</span>append(d1list[<span style="color:#ae81ff">0</span>]<span style="color:#f92672">.</span>replace(<span style="color:#e6db74">&#39;偏&#39;</span>,<span style="color:#e6db74">&#39;&#39;</span>))
</span></span><span style="display:flex;"><span>			Diraction2<span style="color:#f92672">.</span>append(d2list[<span style="color:#ae81ff">0</span>]<span style="color:#f92672">.</span>replace(<span style="color:#e6db74">&#39;偏&#39;</span>,<span style="color:#e6db74">&#39;&#39;</span>))
</span></span><span style="display:flex;"><span>			<span style="color:#75715e">#在使用正则表达式读取风向的时候，会读进&#39;偏&#39;字符</span>
</span></span><span style="display:flex;"><span>			<span style="color:#75715e">#在进行数据处理时则将偏字去除以备后期进行字典代换</span>
</span></span><span style="display:flex;"><span>			minScale<span style="color:#f92672">.</span>append(minscale)
</span></span><span style="display:flex;"><span>			maxScale<span style="color:#f92672">.</span>append(maxscale)
</span></span><span style="display:flex;"><span>	
</span></span><span style="display:flex;"><span>	<span style="color:#75715e">#手动写入方向和度数的对应字典</span>
</span></span><span style="display:flex;"><span>	word_to_num<span style="color:#f92672">=</span>{<span style="color:#e6db74">&#39;东&#39;</span>:<span style="color:#ae81ff">0</span>,<span style="color:#e6db74">&#39;西&#39;</span>:<span style="color:#ae81ff">180</span>,<span style="color:#e6db74">&#39;南&#39;</span>:<span style="color:#ae81ff">270</span>,<span style="color:#e6db74">&#39;北&#39;</span>:<span style="color:#ae81ff">90</span>,<span style="color:#e6db74">&#39;东南&#39;</span>:<span style="color:#ae81ff">315</span>,<span style="color:#e6db74">&#39;东北&#39;</span>:<span style="color:#ae81ff">45</span>,<span style="color:#e6db74">&#39;西南&#39;</span>:<span style="color:#ae81ff">225</span>,<span style="color:#e6db74">&#39;西北&#39;</span>:<span style="color:#ae81ff">135</span>}
</span></span><span style="display:flex;"><span>	<span style="color:#75715e">#预先分配读入读数的list</span>
</span></span><span style="display:flex;"><span>	Diraction1_num<span style="color:#f92672">=</span>[]
</span></span><span style="display:flex;"><span>	Diraction2_num<span style="color:#f92672">=</span>[]
</span></span><span style="display:flex;"><span>	<span style="color:#75715e">#使用已写好的字典对方向进行代换</span>
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">for</span> i <span style="color:#f92672">in</span> range(len(Time)):
</span></span><span style="display:flex;"><span>		Diraction1_num<span style="color:#f92672">.</span>append(word_to_num[Diraction1[i]])
</span></span><span style="display:flex;"><span>		Diraction2_num<span style="color:#f92672">.</span>append(word_to_num[Diraction2[i]])
</span></span><span style="display:flex;"><span>	<span style="color:#75715e">#生成新字典并且生成表格</span>
</span></span><span style="display:flex;"><span>	dira_and_scale<span style="color:#f92672">=</span>{<span style="color:#e6db74">&#39;日期&#39;</span>:Time,<span style="color:#e6db74">&#39;风向1&#39;</span>:Diraction1,<span style="color:#e6db74">&#39;风向1num&#39;</span>:Diraction1_num,<span style="color:#e6db74">&#39;风向2&#39;</span>:Diraction2,<span style="color:#e6db74">&#39;风向2num&#39;</span>:Diraction2_num,<span style="color:#e6db74">&#39;小风级&#39;</span>:minScale,<span style="color:#e6db74">&#39;大风级&#39;</span>:maxScale}
</span></span><span style="display:flex;"><span>	df<span style="color:#f92672">=</span>pd<span style="color:#f92672">.</span>DataFrame(dira_and_scale)
</span></span><span style="display:flex;"><span>	processedPath<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;./ProcessedData/data.xlsx&#39;</span>
</span></span><span style="display:flex;"><span>	<span style="color:#75715e">#将生成的表格记录下</span>
</span></span><span style="display:flex;"><span>	file<span style="color:#f92672">=</span>df<span style="color:#f92672">.</span>to_excel(processedPath)
</span></span></code></pre></div><h1 id="结论">结论<a hidden class="anchor" aria-hidden="true" href="#结论">#</a></h1>
<p>首先是得到一张十年尺度的日期-风向风级的表格, 其中已经包含了对风向读为度数的列.</p>
<p>使用 OriginPro 的风向玫瑰图的绘制功能不难绘制出风向和风级在大风管制期间的规律. 由上述图可以分析得到的结论是:</p>
<ol>
<li>大风管制发生时，风向各个风向都有，但是大多集中在西北方向，而且也是西北方向的风级最大;</li>
<li>风级一般要达到5级及以上时才会触发满足大风管制的条件.</li>
</ol>
<p><img loading="lazy" src="https://s2.loli.net/2023/05/20/x6UIYmz9yED3ZiH.png" alt="Max Scale"  />
</p>
<p><img loading="lazy" src="https://s2.loli.net/2023/05/20/x6UIYmz9yED3ZiH.png" alt="Min Scale"  />
</p>


        </div>
        <div class="post-reward">
            <div style="padding: 0 0 0 0; margin: 0 0 0 0; width: 100%; font-size:16px; text-align: center;">
                <div id="QR" style="opacity: 0;">
                    <div id="wechat" style="display: inline-block">
                        <a class="fancybox" rel="group">
                            <img id="wechat_qr" src="https://s2.loli.net/2023/07/11/SAy54bkgO1HmKlD.jpg" alt="wechat_pay"></a>
                        <p>微信</p>
                    </div>
                    <div id="alipay" style="display: inline-block">
                        <a class="fancybox" rel="group">
                            <img id="alipay_qr" src="https://s2.loli.net/2023/07/11/8IYCUkW5QGXu16v.jpg" alt="alipay"></a>
                        <p>支付宝</p>
                    </div>
                </div>
                <button id="rewardButton"
                        onclick="
                    var qr = document.getElementById('QR');
                    if (qr.style.opacity === '0') {
                        qr.style.opacity='1';
                    } else {
                        qr.style.opacity='0'
                    }"
                >
                    <span>🧧 鼓励</span>
                </button>
            </div>
        </div>

        <footer class="post-footer">
            
<nav class="paginav">
  <a class="prev" href="https://Muatyz.github.io/posts/phy/hcmp/density-generalized-function-theory/">
    <span class="title">« 上一页</span>
    <br>
    <span>多体: 密度泛函理论</span>
  </a>
  <a class="next" href="https://Muatyz.github.io/posts/cs/datastructure/wangdao/">
    <span class="title">下一页 »</span>
    <br>
    <span>数据结构反思总结</span>
  </a>
</nav>

        </footer>
    </div>

<style>
    .comments_details summary::marker {
        font-size: 20px;
        content: '👉展开评论';
        color: var(--content);
    }
    .comments_details[open] summary::marker{
        font-size: 20px;
        content: '👇关闭评论';
        color: var(--content);
    }
</style>





<div>
    <div class="pagination__title">
        <span class="pagination__title-h" style="font-size: 20px;">💬评论</span>
        <hr />
    </div>
    <div id="tcomment"></div>
    <script src="https://cdn.staticfile.org/twikoo/1.6.16/twikoo.all.min.js"></script>
    <script>
        twikoo.init({
            envId: "https://twikoo-api-one-xi.vercel.app",  
            el: "#tcomment",
            lang: 'zh-CN',
            region: 'ap-shanghai',  
            path: window.TWIKOO_MAGIC_PATH||window.location.pathname,
        });
    </script>
</div>
</article>
</main>

<footer class="footer">
    <span>Muartz</span>
</footer>
<a href="#top" aria-label="go to top" title="Go to Top (Alt + G)" class="top-link" id="top-link" accesskey="g">
    <span class="topInner">
        <svg class="topSvg" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentColor">
            <path d="M12 6H0l6-6z"/>
        </svg>
        <span id="read_progress"></span>
    </span>
</a>

<script>
    document.addEventListener('scroll', function (e) {
        const readProgress = document.getElementById("read_progress");
        const scrollHeight = document.documentElement.scrollHeight;
        const clientHeight = document.documentElement.clientHeight;
        const scrollTop = document.documentElement.scrollTop || document.body.scrollTop;
        readProgress.innerText = ((scrollTop / (scrollHeight - clientHeight)).toFixed(2) * 100).toFixed(0);
    })
</script><script>

    let detail = document.getElementsByClassName('details')
   
    details = [].slice.call(detail);
   
    for (let index = 0; index < details.length; index++) {
   
    let element = details[index]
   
    const summary = element.getElementsByClassName('details-summary')[0];
   
    if (summary) {
   
    summary.addEventListener('click', () => {
   
    element.classList.toggle('open');
   
    }, false);
   
    }
   
    }
   
   </script>   

<script>
    let menu = document.getElementById('menu')
    if (menu) {
        menu.scrollLeft = localStorage.getItem("menu-scroll-position");
        menu.onscroll = function () {
            localStorage.setItem("menu-scroll-position", menu.scrollLeft);
        }
    }

    document.querySelectorAll('a[href^="#"]').forEach(anchor => {
        anchor.addEventListener("click", function (e) {
            e.preventDefault();
            var id = this.getAttribute("href").substr(1);
            if (!window.matchMedia('(prefers-reduced-motion: reduce)').matches) {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView({
                    behavior: "smooth"
                });
            } else {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView();
            }
            if (id === "top") {
                history.replaceState(null, null, " ");
            } else {
                history.pushState(null, null, `#${id}`);
            }
        });
    });
</script>
<script>
    let mybutton = document.getElementById("top-link");
    window.onscroll = function () {
        if (document.body.scrollTop > 200 || document.documentElement.scrollTop > 200) {
            mybutton.style.visibility = "visible";
            mybutton.style.opacity = "1";
        } else {
            mybutton.style.visibility = "hidden";
            mybutton.style.opacity = "0";
        }
    };
</script>
<script>
    document.getElementById("theme-toggle").addEventListener("click", () => {
        (function() {
            document.cookie = "change-themes" + "="+ escape ("false");
        })()

        if (document.body.className.includes("dark")) {
            document.body.classList.remove('dark');
            localStorage.setItem("pref-theme", 'light');
        } else {
            document.body.classList.add('dark');
            localStorage.setItem("pref-theme", 'dark');
        }
    });
</script>

<script>
    document.body.addEventListener('copy', function (e) {
        if (window.getSelection().toString() && window.getSelection().toString().length > 50) {
            let clipboardData = e.clipboardData || window.clipboardData;
            if (clipboardData) {
                e.preventDefault();
                let htmlData = window.getSelection().toString() +
                    '\r\n\n————————————————\r\n' +
                    '版权声明：本文为「'+"无处惹尘埃"+'」的原创文章，遵循CC 4.0 BY-SA版权协议，转载请附上原文出处链接及本声明。' +
                '\r\n原文链接：' + location.href;
                let textData = window.getSelection().toString() +
                    '\r\n\n————————————————\r\n' +
                    '版权声明：本文为「'+"无处惹尘埃"+'」的原创文章，遵循CC 4.0 BY-SA版权协议，转载请附上原文出处链接及本声明。' +
                '\r\n原文链接：' + location.href;
                clipboardData.setData('text/html', htmlData);
                clipboardData.setData('text/plain', textData);
            }
        }
    });
</script>
<script>
    document.querySelectorAll('pre > code').forEach((codeblock) => {
        const container = codeblock.parentNode.parentNode;
        const copybutton = document.createElement('button');
        copybutton.classList.add('copy-code');
        copybutton.innerText = '复制';

        function copyingDone() {
            copybutton.innerText = '已复制！';
            setTimeout(() => {
                copybutton.innerText = '复制';
            }, 2000);
        }

        copybutton.addEventListener('click', (cb) => {
            if ('clipboard' in navigator) {
                let text = codeblock.textContent +
                    '\r\n————————————————\r\n' +
                    '版权声明：本文为「'+"无处惹尘埃"+'」的原创文章，遵循CC 4.0 BY-SA版权协议，转载请附上原文出处链接及本声明。' +
                '\r\n原文链接：' + location.href;
                navigator.clipboard.writeText(text);
                copyingDone();
                return;
            }

            const range = document.createRange();
            range.selectNodeContents(codeblock);
            const selection = window.getSelection();
            selection.removeAllRanges();
            selection.addRange(range);
            try {
                document.execCommand('copy');
                copyingDone();
            } catch (e) {}
            selection.removeRange(range);
        });

        let language = codeblock.className.replaceAll("language-", "")
        let macTool = document.createElement("div")
        let macTool1 = document.createElement("div")
        let macTool2 = document.createElement("div")
        let macTool3 = document.createElement("div")
        let languageType = document.createElement("div")
        languageType.innerText = language
        macTool.setAttribute('class', 'mac-tool')
        macTool1.setAttribute('class', 'mac bb1')
        macTool2.setAttribute('class', 'mac bb2')
        macTool3.setAttribute('class', 'mac bb3')
        languageType.setAttribute('class', 'language-type')
        macTool.appendChild(macTool1)
        macTool.appendChild(macTool2)
        macTool.appendChild(macTool3)
        macTool.appendChild(languageType)

        if (container.classList.contains("highlight")) {
            container.appendChild(copybutton);
            container.appendChild(macTool)
        } else if (container.parentNode.firstChild == container) {
            
        } else if (codeblock.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName == "TABLE") {
            
            codeblock.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(copybutton);
            container.appendChild(macTool)
        } else {
            
            codeblock.parentNode.appendChild(copybutton);
            container.appendChild(macTool)
        }
    });
</script>

<script>
    $("code[class^=language] ").on("mouseover", function () {
        if (this.clientWidth < this.scrollWidth) {
            $(this).css("width", "135%")
            $(this).css("border-top-right-radius", "var(--radius)")
        }
    }).on("mouseout", function () {
        $(this).css("width", "100%")
        $(this).css("border-top-right-radius", "unset")
    })
</script>


<script>
    
    document.addEventListener('keydown', function(event) {
      
      if (event.key === 'j') {
        
        var nextPageLink = document.querySelector('.pagination-item.pagination-next > a');
        if (nextPageLink) {
          nextPageLink.click();
        }
      } else if (event.key === 'k') {
        
        var prevPageLink = document.querySelector('.pagination-item.pagination-previous > a');
        if (prevPageLink) {
          prevPageLink.click();
        }
      }
    });
  </script>
  

<script type="text/javascript" src="https://cdn.jsdelivr.net/gh/fz6m/Private-web@1.2/js/custom/click.min.js"></script>

</body>





<head>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/katex.min.css" integrity="sha384-AfEj0r4/OFrOo5t7NnNe46zW/tFgW6x/bCJG8FqQCEo3+Aro6EYUG4+cU+KJWu/X" crossorigin="anonymous">
    <script defer src="https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/katex.min.js" integrity="sha384-g7c+Jr9ZivxKLnZTDUhnkOnsh30B4H0rpLUpJ4jAIKs4fnJI+sEnkvrMWph2EDg4" crossorigin="anonymous"></script>
    <script defer src="https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/contrib/auto-render.min.js" integrity="sha384-mll67QQFJfxn0IYznZYonOWZ644AWYC+Pt2cHqMaRhXVrursRwvLnLaebdGIlYNa" crossorigin="anonymous"></script>
  </head>


<body>

  <link rel="stylesheet" href="https://cdn.staticfile.org/lxgw-wenkai-screen-webfont/1.6.0/lxgwwenkaiscreen.css" media="print" onload="this.media='all'">
  
  </body>


</html>
